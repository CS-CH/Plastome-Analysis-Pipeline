# Selection Analyses (Branch and Branch-site Models)

This folder contains scripts used to perform branch and branch-site selection analyses based on codon alignments using PAML (codeml) via the ETE3 framework.

## Overview

Selection analyses were conducted using codon-based likelihood models implemented in codeml and interfaced through ETE3. Branch models were used to test for shifts in selective constraints along predefined foreground branches, and branch-site models were applied to detect episodic positive selection affecting specific sites along those branches.

All analyses were performed gene-by-gene using predefined codon alignments and a fixed species tree.

## Scripts

### 1. `ete3_paml_branchsite_batch.py`

This script:
- Iterates over codon alignments (`*.fasta`) in the `alignments/` directory
- Links each alignment to a fixed Newick-format species tree
- Marks predefined foreground branches (e.g., *Mitrastemon*)
- Runs branch-site models `bsA1` (null model) and `bsA` (positive selection model) using ETE3
- Organizes model outputs into gene-specific subdirectories

Foreground branches are specified by leaf names and can be modified in the script.

### 2. `paml_branch_branchsite_LRT_summary.py`

This script:
- Parses codeml output files generated by ETE3
- Extracts log-likelihood values (lnL), number of parameters (np), and ω (dN/dS) estimates
- Performs likelihood ratio tests (LRTs) for:
  - branch model comparisons
  - branch-site model comparison (bsA vs. bsA1)
- Identifies genes showing evidence of relaxed or strengthened selective constraint
- Detects branch-site positive selection based on LRT significance
- Extracts Bayes Empirical Bayes (BEB) sites with posterior probability ≥ 0.95
- Outputs a summary table (`branch_branchsite_LRT.csv`) for downstream analyses

## Statistical Inference

Likelihood ratio tests were evaluated using a chi-square distribution with degrees of freedom determined by the difference in model parameters. Statistical significance was assessed at P < 0.05 unless otherwise stated.

## Dependencies

- Python ≥ 3.x
- ETE3
- PAML (codeml)
- SciPy

## Notes

All analyses are hypothesis-driven with predefined foreground branches. Scripts are provided to ensure full transparency and reproducibility of the selection analyses reported in the manuscript.
